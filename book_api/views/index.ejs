<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('./head'); %>
    <link rel="stylesheet" type="text/css" href="/stylesheets/index.css">
    <script type="text/javascript" src="/javascripts/index.js"></script>
</head>
<body class="container">

<header>
    <%- include('./header'); %>
</header>

<main>
    <% if (!locals.idmember) { %>
      

      <!-- START Anastasiia: body-->
      <!-- body of the main page -->
      <div class="MainBody">
           <img src="https://github.com/OAMK-DIN20SP/Web-programming-project-/blob/main/book_api/public/images/Book-Wallpaper-02-2560-x-1600.jpeg?raw=true">
      <div class="centeredBody">
           <p>Welcome to the book exchange platform!</p>
           <p>Here you can give away your old books and find new ones.</p>
      <!-- Search -->
      <form>
        <div class="search">
             <label for="Title">Book title:</label><br>
             <input type="text" id="Title"><br>
             <button><i class="fas fa-search"></i></button>
        </div>
        <div class="search">
             <label for="Author">Book author:</label><br>
             <input type="text" id="Author">
             <button><i class="fas fa-search"></i></button>
        </div>
      </form>
      <script type="text/javascript">
        function displaySearchResult(url) {
          $.get(url, (data) => {
            console.log(data);
            const books = data.books;
            let searchResultElem = document.createElement('div');
            searchResultElem.id = 'search-result';
            
            let innerHTMLString = `
              <div class="search-result-title">
                <h2>Search Results</h2>
                <button id="btn-close-search-result">Close</button>
              </div>
              <table>
                <thead>
                  <tr>
                    <td>Book cover</td>
                    <td>Title</td>
                    <td>Author(s)</td>
                    <td>Owner's ID</td>
                  </tr>
                </thead>
                <tbody>`;

                console.log(innerHTMLString);
            
            for (let book of books) {
              innerHTMLString += `
                <tr>
                  <td><a href="/book?idbook=${book.idbook}" target="_blank"><img src="/images/books/${book.image}" style="width: 150px; height: 150px; cursor: pointer;"></a></td>
                  <td>${book.title}</td>
                  <td>${book.author}</td>
                  <td>${book.idmember}</td>
                </tr>`;
            };

            console.log(innerHTMLString);

            innerHTMLString += `</tbody></table>`;

            console.log(innerHTMLString);

            searchResultElem.innerHTML = innerHTMLString;

            $('main').append(searchResultElem);

            $('#btn-close-search-result').click( () => $('#search-result').remove() );
            
          });
        }


        $('#Title').keypress( (e) => {
          console.log(e.key);
          if (e.key == 'Enter') {
            // const title = $(this).val();
            const title = $('#Title').val();
            console.log(title);
            const url = '/book/search?title=' + title;
            displaySearchResult(url);
          }
        });

        $('#Author').keypress( (e) => {
          console.log(e.key);
          if (e.key == 'Enter') {
            const author = $('#Author').val();
            console.log(author);
            const url = '/book/search?author=' + author;
            displaySearchResult(url);
          }
        });

      </script>
      <style type="text/css">
        table, th, td {
          border: 1px solid black;
          padding: 5px;
        }

        table {
          border-collapse: collapse;
        }

        #search-result {
          position: absolute;
          display: block;
          z-index: 999;
          background: wheat;
          top: 50%;
        }

      </style>
      <br>
      <button id="btn-latest-books">See latest posted books</button>
      
      <script type="text/javascript">
        $('#btn-latest-books').click( () => {
          displaySearchResult('/book/latest');
        });
      </script>
      </div>

      <!--About project (here should be sent when clicking "about" in header)-->
      <h1>How does it work</h1>
      <div class="about">
      <p>You search for the book<br>
          <i class="fas fa-search"></i>
      </p>
      <p>Agree with the owner<br>
          <i class="far fa-handshake"></i>
      </p>
      <p>Share books you want to give away<br>
          <i class="fas fa-recycle"></i>
      </p>
      </div>

      <!--Create account sugestion-->
      <div class="sugestion">
         <p>And do not forget to share your books</p>
         <button onclick="openSignupForm()">Create account</button>
      </div>
      <!-- END Anastasiia: body-->

      

      <!-- START thuc:login update data validation -->
      
        
    <% } %>
</main>

<footer>
    <%- include('./footer'); %>
</footer>



</body>
</html>